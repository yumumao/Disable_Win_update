# Disable_Win_update 🛡️

一个用于禁用Windows自动更新的工具集，支持定时自动执行和手动执行。

## 📁 文件说明

| 文件名 | 功能描述 |
|--------|----------|
| `disable_update_daily.bat` | 主执行脚本，禁用Windows更新服务和清理更新文件 |
| `wrapper_script.ps1` | PowerShell包装脚本，处理触发器逻辑和空闲检测 |
| `disable_windows_update.reg` | 注册表配置文件，包含禁用更新的注册表项 |
| `0.create_scheduled_task.ps1` | 计划任务创建脚本，设置定时执行 |
| `PsExec.exe` | 系统工具，用于高权限执行 |

## 🚀 快速开始

### 方法1：手动执行
```cmd
# 以管理员身份运行
disable_update_daily.bat
```

### 方法2：创建计划任务（推荐）
```powershell
# 以管理员身份运行PowerShell
.\0.create_scheduled_task.ps1
```

## ⚙️ 功能特性

- **服务管理**：停止并禁用 `wuauserv`、`UsoSvc`、`WaaSMedicSvc` 等更新服务
- **注册表配置**：应用禁用自动更新的注册表设置
- **文件清理**：删除 `$WINDOWS.~BT` 升级文件夹和 `SoftwareDistribution` 更新缓存
- **智能触发**：支持系统启动、定时（00/03/06/12/18/21点）和手动触发
- **空闲检测**：在用户空闲3分钟后执行，避免干扰正常使用
- **日志记录**：详细记录执行过程，自动管理日志大小（超过5万行清理一半）
- **用户提示**：执行完成后显示友好的提示对话框

## 📊 触发机制

| 触发类型 | 执行条件 | 说明 |
|---------|----------|------|
| 系统启动 | 开机后10分钟内 | 立即执行，确保开机后禁用更新 |
| 定时触发 | 每日 00/03/06/12/18/21 点 | 用户空闲3分钟后执行 |
| 手动执行 | 双击脚本 | 立即执行 |

## 📝 日志文件

- **位置**：与脚本同目录的 `update_disable_log.txt`
- **内容**：执行时间、触发方式、操作结果、错误代码
- **管理**：超过5万行自动清理，保留最新2.5万行

## ⚠️ 注意事项

1. **管理员权限**：所有操作需要管理员权限
2. **杀毒软件**：可能被误报，请添加到白名单
3. **系统兼容**：适用于 Windows 10/11
4. **备份建议**：首次使用前建议创建系统还原点

## 🔧 故障排除

### 常见错误代码
- `0` = 成功
- `2` = 服务不存在或已停止
- `5` = 访问被拒绝
- `1060` = 服务未安装
- `1062` = 服务未启动

### 检查日志
查看 `update_disable_log.txt` 了解详细执行情况和错误信息。

## 📞 支持

如遇问题，请检查：
1. 是否以管理员权限运行
2. 杀毒软件是否阻止执行
3. 查看日志文件了解具体错误
```